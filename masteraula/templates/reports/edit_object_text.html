{% extends "base.html" %}
{% load static %}

{% block content %}
<h1>{{header}}</h1>



<form method="POST">
    {% csrf_token %}
    {% for discipline in disciplines %}
        <input type="checkbox" name="disciplines" value="{{discipline.id}}">
            {{discipline.name}}
        </input><br>
    {% endfor %}
    <input type="submit" value="Enviar">
</form>
{% for results in data %}
    <div id="lo{{results.0}}">
    <hr>
    <h1>Objeto {{ results.0 }}</h1>
    <table style='width: 100%' border="">
        <tr>
            <td>
                <textarea id='txtstmt{{results.0}}' onchange="replacestmt({{results.0}})" style='width: 100%; height: 300px'>{{ results.1 }}</textarea>
            </td>
            <td>
                <textarea id='txtclean{{results.0}}' onchange="replaceclean({{results.0}})" style='width: 100%; height: 300px'>{{ results.2 }}</textarea>
            </td>
        </tr>
        <tr>
            <td id='stmt{{results.0}}'>
                {{ results.1 |safe}}
            </td>
            <td id='clean{{results.0}}'>
                {{ results.2 |safe}}
            </td>
        </tr>
    </table>
    <button onclick="update({{results.0}})">Modificar</button>
    <span id="status{{results.0}}"></span>
    </div>
{% endfor %}

<script>
function replacestmt(id) {
    const stmt = document.getElementById("txtstmt" + id).value;
    document.getElementById("stmt"+id).innerHTML = stmt;
}

function replaceclean(id) {
    const clean = document.getElementById("txtclean" + id).value;
    document.getElementById("clean"+id).innerHTML = clean;
}

function update(id) {
    const  token = "{{ csrf_token }}";
    const new_text = document.getElementById("txtclean" + id)

    const data = { 
        id,
        text: new_text ? new_text.value : null,
        source: null
    }

    $.ajax({
        type: "POST",
        url: "/reports/learning_object_update/",
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify(data),
        headers: { "X-CSRFToken": token },
    }).done(function() {
        document.getElementById('status' + id).innerHTML = "Modificado"
    })
    .fail(function() {
        alert( "error" );
    });
}
</script>

{% endblock %}